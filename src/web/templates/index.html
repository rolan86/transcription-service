{% extends "base.html" %}

{% block title %}{{ title }}{% endblock %}

{% block content %}
<div class="transcription-app">
    <!-- Mode Selector -->
    <div class="mode-selector">
        <button class="mode-btn active" data-mode="upload">
            <span class="icon">&#128193;</span>
            Upload File
        </button>
        <button class="mode-btn" data-mode="url">
            <span class="icon">&#128279;</span>
            URL Import
        </button>
        <button class="mode-btn" data-mode="record">
            <span class="icon">&#127908;</span>
            Record Audio
        </button>
    </div>

    <!-- Settings Panel -->
    <div class="settings-panel">
        <div class="setting-group">
            <label for="model-select">Model</label>
            <select id="model-select">
                <option value="tiny">Tiny (Fastest)</option>
                <option value="base" selected>Base (Balanced)</option>
                <option value="small">Small (Better)</option>
                <option value="medium">Medium (High Quality)</option>
                <option value="large">Large (Best)</option>
            </select>
        </div>
        <div class="setting-group">
            <label for="language-select">Language</label>
            <select id="language-select">
                <option value="">Auto-detect</option>
                <option value="en">English</option>
                <option value="es">Spanish</option>
                <option value="fr">French</option>
                <option value="de">German</option>
                <option value="it">Italian</option>
                <option value="pt">Portuguese</option>
                <option value="ja">Japanese</option>
                <option value="ko">Korean</option>
                <option value="zh">Chinese</option>
                <option value="hi">Hindi</option>
            </select>
        </div>
        <div class="setting-group">
            <label for="format-select">Output Format</label>
            <select id="format-select">
                <option value="json" selected>JSON</option>
                <option value="txt">Plain Text</option>
                <option value="srt">SRT Subtitles</option>
                <option value="vtt">VTT Subtitles</option>
            </select>
        </div>
        <!-- Options row for checkboxes -->
        <div class="settings-options">
            <div class="setting-group checkbox-group">
                <label>
                    <input type="checkbox" id="enable-speakers">
                    Speaker Detection
                </label>
            </div>
            <div class="setting-group checkbox-group">
                <label>
                    <input type="checkbox" id="show-timestamps">
                    Timestamps
                </label>
            </div>
            <div class="setting-group checkbox-group">
                <label>
                    <input type="checkbox" id="show-confidence">
                    Confidence Highlights
                </label>
            </div>
            <div class="setting-group checkbox-group vocabulary-group">
                <label>
                    <input type="checkbox" id="use-vocabulary">
                    Custom Vocabulary
                </label>
                <button class="vocab-edit-btn" id="vocab-edit-btn" title="Edit Vocabulary">Edit</button>
            </div>
        </div>
    </div>

    <!-- Upload Mode -->
    <div id="upload-mode" class="mode-content active">
        <div class="upload-zone" id="upload-zone">
            <div class="upload-icon">&#128194;</div>
            <p class="upload-text">Drag & drop audio/video file here</p>
            <p class="upload-subtext">or click to browse</p>
            <input type="file" id="file-input" accept=".mp3,.wav,.m4a,.flac,.mp4,.mov,.avi" hidden>
            <p class="supported-formats">Supported: MP3, WAV, M4A, FLAC, MP4, MOV, AVI</p>
        </div>
        <div class="file-info" id="file-info" hidden>
            <span class="file-name"></span>
            <button class="remove-file" id="remove-file">&times;</button>
        </div>
        <button class="transcribe-btn" id="transcribe-btn" disabled>
            Transcribe
        </button>
    </div>

    <!-- URL Mode -->
    <div id="url-mode" class="mode-content">
        <div class="url-input-container">
            <div class="url-input-group">
                <input type="text" id="url-input" class="url-input" placeholder="Paste YouTube or Vimeo URL here...">
                <button class="url-fetch-btn" id="url-fetch-btn">Fetch Info</button>
            </div>
            <p class="url-hint">Supported: YouTube (youtube.com, youtu.be) and Vimeo (vimeo.com)</p>
        </div>
        <div class="url-preview" id="url-preview" hidden>
            <div class="url-thumbnail" id="url-thumbnail"></div>
            <div class="url-info">
                <h4 class="url-title" id="url-title"></h4>
                <p class="url-meta">
                    <span id="url-uploader"></span>
                    <span id="url-duration"></span>
                </p>
            </div>
            <button class="url-clear-btn" id="url-clear-btn">&times;</button>
        </div>
        <button class="transcribe-btn" id="url-transcribe-btn" disabled>
            Transcribe from URL
        </button>
    </div>

    <!-- Record Mode -->
    <div id="record-mode" class="mode-content">
        <div class="record-controls">
            <button class="record-btn" id="record-btn">
                <span class="record-icon"></span>
                <span class="record-text">Start Recording</span>
            </button>
            <div class="record-timer" id="record-timer">00:00</div>
        </div>
        <div class="audio-level" id="audio-level">
            <div class="level-bar"></div>
        </div>
        <p class="record-hint">Click to start recording from your microphone</p>

        <!-- Recording Actions (shown after recording stops) -->
        <div class="recording-actions" id="recording-actions" hidden>
            <button class="action-btn" id="download-audio-btn">Download Audio</button>
            <button class="action-btn secondary" id="new-recording-btn">New Recording</button>
        </div>
    </div>

    <!-- Progress -->
    <div class="progress-container" id="progress-container" hidden>
        <div class="progress-bar">
            <div class="progress-fill" id="progress-fill"></div>
        </div>
        <p class="progress-text" id="progress-text">Processing...</p>
    </div>

    <!-- Results -->
    <div class="results-container" id="results-container" hidden>
        <div class="results-header">
            <h2>Transcription Result</h2>
            <div class="results-meta">
                <span class="meta-item" id="result-language"></span>
                <span class="meta-item" id="result-confidence"></span>
                <span class="meta-item" id="result-time"></span>
            </div>
            <button class="rename-speakers-btn" id="rename-speakers-btn" hidden>Rename Speakers</button>
        </div>
        <div class="transcript-box" id="transcript-box">
            <pre id="transcript-text"></pre>
        </div>
        <div class="results-actions">
            <button class="action-btn" id="copy-btn">Copy Text</button>
            <button class="action-btn" id="download-btn">Download</button>
            <button class="action-btn" id="translate-btn">Translate</button>
            <button class="action-btn secondary" id="new-transcription-btn">New Transcription</button>
        </div>
    </div>

    <!-- Live Transcript (for recording mode) -->
    <div class="live-transcript" id="live-transcript" hidden>
        <h3>Live Transcript</h3>
        <div class="live-text" id="live-text"></div>
    </div>

    <!-- Error Display -->
    <div class="error-container" id="error-container" hidden>
        <div class="error-message" id="error-message"></div>
        <button class="action-btn secondary" id="error-dismiss">Dismiss</button>
    </div>

    <!-- Filename Modal -->
    <div class="modal-overlay" id="filename-modal" hidden>
        <div class="modal-content">
            <h3 class="modal-title" id="modal-title">Save File</h3>
            <div class="modal-body">
                <label for="filename-input">File name:</label>
                <div class="filename-input-group">
                    <input type="text" id="filename-input" placeholder="Enter filename">
                    <span class="filename-extension" id="filename-extension">.txt</span>
                </div>
            </div>
            <div class="modal-actions">
                <button class="action-btn secondary" id="modal-cancel">Cancel</button>
                <button class="action-btn" id="modal-confirm">Download</button>
            </div>
        </div>
    </div>

    <!-- Speaker Rename Modal -->
    <div class="modal-overlay" id="speaker-modal" hidden>
        <div class="modal-content">
            <h3 class="modal-title">Rename Speakers</h3>
            <div class="modal-body">
                <p style="margin-bottom: 16px; color: var(--text-muted); font-size: 0.875rem;">
                    Enter custom names for each speaker. Leave blank to keep original label.
                </p>
                <div class="speaker-rename-list" id="speaker-rename-list">
                    <!-- Speaker rename inputs will be dynamically added here -->
                </div>
            </div>
            <div class="modal-actions">
                <button class="action-btn secondary" id="speaker-modal-cancel">Cancel</button>
                <button class="action-btn" id="speaker-modal-confirm">Apply</button>
            </div>
        </div>
    </div>

    <!-- Vocabulary Modal -->
    <div class="modal-overlay" id="vocabulary-modal" hidden>
        <div class="modal-content modal-large">
            <h3 class="modal-title">Custom Vocabulary</h3>
            <div class="modal-body">
                <p style="margin-bottom: 12px; color: var(--text-muted); font-size: 0.875rem;">
                    Add domain-specific words, technical terms, or names to improve transcription accuracy.
                    Enter one term per line.
                </p>
                <textarea
                    id="vocabulary-textarea"
                    class="vocabulary-textarea"
                    placeholder="Enter custom vocabulary (one term per line)&#10;&#10;Examples:&#10;PyTorch&#10;Kubernetes&#10;Dr. Smith"
                    rows="10"
                ></textarea>
                <div class="vocab-count" id="vocab-count">0 terms</div>
            </div>
            <div class="modal-actions">
                <button class="action-btn secondary" id="vocab-modal-cancel">Cancel</button>
                <button class="action-btn" id="vocab-modal-save">Save</button>
            </div>
        </div>
    </div>

    <!-- Translation Modal -->
    <div class="modal-overlay" id="translation-modal" hidden>
        <div class="modal-content modal-large">
            <h3 class="modal-title">Translate Transcript</h3>
            <div class="modal-body">
                <div class="translation-settings">
                    <div class="translation-lang-row">
                        <div class="translation-lang-group">
                            <label for="translate-from">From</label>
                            <select id="translate-from" class="translation-select">
                                <option value="en">English</option>
                            </select>
                        </div>
                        <span class="translation-arrow">&#8594;</span>
                        <div class="translation-lang-group">
                            <label for="translate-to">To</label>
                            <select id="translate-to" class="translation-select">
                                <option value="">Select language...</option>
                            </select>
                        </div>
                    </div>
                </div>
                <div class="translation-progress" id="translation-progress" hidden>
                    <div class="progress-bar">
                        <div class="progress-fill" id="translation-progress-fill"></div>
                    </div>
                    <p class="progress-text" id="translation-progress-text">Translating...</p>
                </div>
                <div class="translation-result" id="translation-result" hidden>
                    <label>Translated Text</label>
                    <div class="translation-output" id="translation-output"></div>
                </div>
            </div>
            <div class="modal-actions">
                <button class="action-btn secondary" id="translation-modal-cancel">Cancel</button>
                <button class="action-btn" id="translation-modal-translate">Translate</button>
                <button class="action-btn" id="translation-modal-copy" hidden>Copy Translation</button>
            </div>
        </div>
    </div>
</div>
{% endblock %}

{% block scripts %}
<script src="/static/js/main.js"></script>
<script src="/static/js/uploader.js"></script>
<script src="/static/js/recorder.js"></script>
<script src="/static/js/websocket.js"></script>
{% endblock %}
